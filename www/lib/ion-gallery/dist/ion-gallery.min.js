!function(){"use strict";function n(n,e,i){function o(n){var o=parseInt(n.ionGalleryRowSize),t=function(){n.ionGalleryRowSize=e.getRowSize(o||i.row_size,n.ionGalleryItems.length),n.actionLabel=i.action_label,n.items=e.buildGallery(n.ionGalleryItems,n.ionGalleryRowSize),n.responsiveGrid=parseInt(1/n.ionGalleryRowSize*100)};t(),function(){n.$watch(function(){return n.ionGalleryItems.length},function(n,e){n!==e&&t()})}()}function t(n,e,o){n.customCallback=angular.isFunction(n.ionItemCallback)&&o.hasOwnProperty("ionItemCallback"),n.ionSliderToggle="false"!==o.ionGalleryToggle&&i.toggle}return o.$inject=["$scope"],{restrict:"AE",scope:{ionGalleryItems:"=ionGalleryItems",ionGalleryRowSize:"=?ionGalleryRow",ionItemCallback:"&?ionItemCallback"},controller:o,link:t,replace:!0,templateUrl:"lib/ion-gallery/src/templates/gallery.html"}}angular.module("ion-gallery",["templates"]).directive("ionGallery",n),n.$inject=["$ionicPlatform","ionGalleryHelper","ionGalleryConfig"]}(),function(){"use strict";function n(){this.config={action_label:"Done",toggle:!0,row_size:3,fixed_row_size:!0},this.$get=function(){return this.config},this.setGalleryConfig=function(n){angular.extend(this.config,this.config,n)}}angular.module("ion-gallery").provider("ionGalleryConfig",n),n.$inject=[]}(),function(){"use strict";function n(n){this.getRowSize=function(e,i){var o;return o=isNaN(e)===!0||e<=0?n.row_size:e>i&&!n.fixed_row_size?i:e},this.buildGallery=function(n,e){for(var i=[],o=-1,t=0,l=0;l<n.length;l++)l%e===0&&(o++,i[o]=[],t=0),n[l].hasOwnProperty("sub")||(n[l].sub=""),n[l].hasOwnProperty("thumb")||(n[l].thumb=n[l].src),n[l].position=l,i[o][t]=n[l],t++;return i}}angular.module("ion-gallery").service("ionGalleryHelper",n),n.$inject=["ionGalleryConfig"]}(),function(){"use strict";function n(){function n(n,e,i){var o=function(n,i){i>0&&(n.naturalHeight>=n.naturalWidth?e.attr("width","100%"):e.attr("height",e.parent()[0].offsetHeight+"px"))};e.bind("load",function(i){var t=this;e.parent()[0].offsetHeight>0&&o(this,e.parent()[0].offsetHeight),n.$watch(function(){return e.parent()[0].offsetHeight},function(n){o(t,n)})})}return{restrict:"A",link:n}}angular.module("ion-gallery").directive("ionImageScale",n),n.$inject=[]}(),function(){"use strict";function n(n){function e(n,e,i){n.$watch(function(){return n.ionGalleryRowSize},function(i,o){i>0&&e.css("height",e[0].offsetWidth*parseInt(n.responsiveGrid)/100+"px")})}return{restrict:"A",link:e}}angular.module("ion-gallery").directive("ionRowHeight",n),n.$inject=["ionGalleryConfig"]}(),function(){"use strict";function n(n,e){function i(i,o,t){var l=!1,r=function(){i.$emit("ZoomStarted")},a=function(n){l=!0,e(function(){l=!1,i.$emit("DoubleTapEvent",{x:n.gesture.touches[0].pageX,y:n.gesture.touches[0].pageY})},200)},c=function(n){l!==!0&&e(function(){l!==!0&&(i.closeModal(),i.$emit("TapEvent"))},200)},s=function(){},d=n.on("pinch",r,o),u=n.on("doubletap",function(n){a(n)},o),g=n.on("tap",c,o),f=n.on("hold",s,o);i.$on("$destroy",function(){n.off(u,"doubletap",a),n.off(g,"tap",c),n.off(d,"pinch",r),n.off(f,"hold",s)})}return{restrict:"A",link:i}}angular.module("ion-gallery").directive("ionSlideAction",n),n.$inject=["$ionicGesture","$timeout"]}(),function(){"use strict";function n(n,e,i,o,t,l){function r(n,e){function i(){var n=navigator.userAgent.toLowerCase();return"micromessenger"==n.match(/MicroMessenger/i)}function r(){s=!1,d()}var a,c,s=(n.ionGalleryRowSize,!1);n.selectedSlide=1,n.hideAll=!1,n.downloadShow=!1,n.isWeiXin=i(),n.showImage=function(e,i){i.stopPropagation(),o(function(){n.downloadShow=!0},3e3),n.selectedSlide=e,n.recordIndex=e,n.recordSlideIndex=e,n.slides=[],n.slides=n.ionGalleryItems,n.loadModal()},n.saveImg=function(n){if(!i()){l.show({buttons:[{text:"<b>保存图片</b> "}],cancelText:"取消",cancel:function(){},buttonClicked:function(i){return e.$broadcast("saveImgUrl",n),!0}})}},n.downloadImg=function(i){i.stopPropagation();var o=n.slides[n.recordIndex].src;e.$broadcast("saveImgUrl",o)},n.slideChanged=function(e){if(e!==a){var i,o=n.slides.length-a-e,l=n.ionGalleryItems.length,r=a+">"+e;"0>1"===r||"1>2"===r||"2>0"===r?(c++,c>=l&&(c=0),i=c+1,i>=l&&(i=0)):"0>2"!==r&&"1>0"!==r&&"2>1"!==r||(c--,c<0&&(c=l-1),i=c-1,i<0&&(i=l-1)),t.$getByHandle("slide-"+o).zoomTo(1),a=e}},n.onSwipeRight=function(e){return n.recordIndex<=0?void n.closeModal():void n.recordIndex--},n.onSwipeLeft=function(e){return n.recordIndex>=n.ionGalleryItems.length-1?void n.closeModal():void n.recordIndex++},n.$on("ZoomStarted",function(e){o(function(){s=!0,n.hideAll=!0})}),n.$on("TapEvent",function(n){o(function(){d()})}),n.$on("DoubleTapEvent",function(n,e){o(function(){u(e)})});var d=function(){return s===!0?(t.$getByHandle("slide-"+a).zoomTo(1,!0),void o(function(){r()},300)):void(n.hasOwnProperty("ionSliderToggle")&&n.ionSliderToggle===!1&&n.hideAll===!1||s===!0||(n.hideAll=!n.hideAll))},u=function(e){s===!1?(t.$getByHandle("slide-"+a).zoomTo(3,!0,e.x,e.y),s=!0,n.hideAll=!0):d()}}function a(e,i,o){var t;e.loadModal=function(){n.fromTemplateUrl("lib/ion-gallery/src/templates/slider.html",{scope:e,animation:"fade-in"}).then(function(n){t=n,e.openModal()})},e.openModal=function(){t.show()},e.closeModal=function(){t.hide()},e.$on("$destroy",function(){try{t.remove()}catch(n){}})}return r.$inject=["$scope","$rootScope"],{restrict:"A",controller:r,link:a}}angular.module("ion-gallery").directive("ionSlider",n),n.$inject=["$ionicModal","ionGalleryHelper","$ionicPlatform","$timeout","$ionicScrollDelegate","$ionicActionSheet"]}(),angular.module("templates",[]).run(["$templateCache",function(n){n.put("gallery.html",'<div class="gallery-view">\n  <div class="row" ng-repeat="item in items track by $index" ion-row-height>\n    <div ng-repeat="photo in item track by $index"\n         class="col col-{{responsiveGrid}} image-container">\n\n      <img ion-image-scale\n           ng-src="{{photo.thumb}}"\n           ng-click="customCallback ? ionItemCallback({item:photo}) : showImage(photo.position,$event)" on-touch="onTouch()" >\n    </div>\n  </div>\n  <div ion-slider></div>\n</div>\n'),n.put("slider.html",'<ion-modal-view class="imageView">\n  <!-- <ion-header-bar class="headerView" ng-show="!hideAll">\n    <button class="button button-outline button-light close-btn" ng-click="closeModal()">{{::actionLabel}}</button>\n  </ion-header-bar> -->\n\n  <ion-content class="has-no-header" scroll="false">\n    <ion-slide-box active-slide="selectedSlide" show-pager="false" class="listContainer" on-slide-changed="slideChanged($index)" >\n      <ion-slide ng-repeat="single in slides track by $index">\n        <ion-scroll direction="xy" locking="false" zooming="true" min-zoom="1" scrollbar-x="false" scrollbar-y="false" ion-slide-action\n          delegate-handle="slide-{{$index}}" overflow-scroll="false" on-swipe-right="onSwipeRight($index)" on-swipe-left="onSwipeLeft($index)">\n          <div class="item item-image gallery-slide-view" style="border-width: 0px !important;">\n            <img ng-src="{{single.src}}" on-hold="saveImg(single.src)">\n          </div>\n          <!-- <button class="button button-outline button-light save-btn" ng-click="saveImg(single.src)">Save</button> -->\n          <div ng-if="single.sub.length > 0" class="image-subtitle" ng-show="!hideAll">\n            <span ng-bind-html=\'single.sub\'></span>\n          </div>\n          <!-- <button class="button  button-icon icon save-btn" ng-click="downloadImg(single.src,$event);$event.stopPropagation();" ng-if="!downloadShow">\n            <img src="img/download.png" style="width:24px;height: 24px;" />\n          </button> -->\n        </ion-scroll>\n      </ion-slide>\n    </ion-slide-box>\n  </ion-content>\n\n  <ion-footer-bar class="headerView">\n    <button class="button  button-icon icon save-btn" ng-click="downloadImg($event);" ng-if="!downloadShow&&!isWeiXin">\n      <img src="img/download.png" style="width:24px;height: 24px;" />\n    </button>\n  </ion-footer-bar>\n</ion-modal-view>')}]);